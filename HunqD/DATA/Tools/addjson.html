<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Timestamp</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    input {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h2>Add Timestamp to JSON</h2>
  
  <label for="jsonChinh">JSON Chính:</label>
  <input type="file" id="jsonChinh" accept=".json">

  <label for="jsonPhu">JSON Phụ:</label>
  <input type="file" id="jsonPhu" accept=".json">

  <button onclick="addTimestamp()">Add Timestamp</button>

  <a id="downloadLink" style="display: none;" download="modified_json.json">
    <button>Download Modified JSON</button>
  </a>

  <script>
    function addTimestamp() {
      const jsonChinhInput = document.getElementById('jsonChinh');
      const jsonPhuInput = document.getElementById('jsonPhu');
      
      if (jsonChinhInput.files.length === 0 || jsonPhuInput.files.length === 0) {
        alert('Please select both JSON files.');
        return;
      }

      const jsonChinhFile = jsonChinhInput.files[0];
      const jsonPhuFile = jsonPhuInput.files[0];

      const reader = new FileReader();

      reader.onload = function(e) {
        try {
          const jsonChinhData = JSON.parse(e.target.result);
          
          const readerPhu = new FileReader();

          readerPhu.onload = function(ePhu) {
            try {
              const jsonPhuData = JSON.parse(ePhu.target.result);

              jsonChinhData.forEach(itemChinh => {
                const matchingItem = jsonPhuData.friends_v2.find(itemPhu => itemPhu.name === itemChinh.name);
                if (matchingItem) {
                  itemChinh.timestamp = matchingItem.timestamp;
                }
              });

              const modifiedJSON = JSON.stringify(jsonChinhData, null, 2);
              const blob = new Blob([modifiedJSON], { type: 'application/json' });

              const downloadLink = document.getElementById('downloadLink');
              downloadLink.href = URL.createObjectURL(blob);
              downloadLink.style.display = 'block';
            } catch (error) {
              alert('Error parsing JSON Phụ: ' + error.message);
            }
          };

          readerPhu.readAsText(jsonPhuFile);
        } catch (error) {
          alert('Error parsing JSON Chính: ' + error.message);
        }
      };

      reader.readAsText(jsonChinhFile);
    }
  </script>
</body>
</html>
