const timetables = {
    "lop42": {
        "Thứ 2": [
            {
                "Môn học": "Hoạt động trải nghiệm",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Công nghệ",
                "Thời gian": "10:15 - 11:00"
            }
        ],
        "Thứ 3": [
            {
                "Môn học": "Tiếng anh",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Tiếng anh",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Kinh nghiệm sống",
                "Thời gian": "10:15 - 11:00"
            }
        ],
        "Thứ 4": [
            {
                "Môn học": "Thể dục",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Mĩ thuật",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Hoạt động trải nghiệm",
                "Thời gian": "10:15 - 11:00"
            },
            {
                "Môn học": "Khoa học",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Đạo đức",
                "Thời gian": "13:45 - 14:30"
            }
        ],
        "Thứ 5": [
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Tiếng anh",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Tiếng anh",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Địa lý",
                "Thời gian": "10:15 - 11:00"
            }
        ],
        "Thứ 6": [
            {
                "Môn học": "Thể dục",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "*HĐTN",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Khoa học",
                "Thời gian": "10:15 - 11:00"
            }
        ],
        "Thứ 7": [
            {
                "Môn học": "Tin học",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Tiếng việt",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Âm nhạc",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Lịch sử",
                "Thời gian": "9:30 - 10:15"
            }
        ]
    },
    "lop65": {
        "Thứ 2": [
            {
                "Môn học": "GD Địa Phương",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Tin học",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Khoa học tự nhiên",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Khoa học tự nhiên",
                "Thời gian": "13:45 - 14:30"
            },
            {
                "Môn học": "Ngoại ngữ",
                "Thời gian": "14:45 - 15:30"
            },
            {
                "Môn học": "Sinh hoạt lớp",
                "Thời gian": "15:30 - 16:15"
            },
            {
                "Môn học": "Chào cờ",
                "Thời gian": "16:15 - 17:00"
            }
        ],
        "Thứ 3": [
            {
                "Môn học": "Khoa học tự nhiên",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "13:45 - 14:30"
            },
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "14:45 - 15:30"
            },
            {
                "Môn học": "Lịch sử và Địa lý",
                "Thời gian": "15:30 - 16:15"
            },
            {
                "Môn học": "Công nghệ",
                "Thời gian": "16:15 - 17:00"
            }
        ],
        "Thứ 4": [
            {
                "Môn học": "Thể dục",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Thể dục",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Ngoại ngữ",
                "Thời gian": "13:45 - 14:30"
            },
            {
                "Môn học": "GDCD",
                "Thời gian": "14:45 - 15:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "15:30 - 16:15"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "16:15 - 17:00"
            }
        ],
        "Thứ 5": [
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Khoa học tự nhiên",
                "Thời gian": "13:45 - 14:30"
            },
            {
                "Môn học": "Âm nhạc",
                "Thời gian": "14:45 - 15:30"
            },
            {
                "Môn học": "Lịch sử và Địa lý",
                "Thời gian": "15:30 - 16:15"
            }
        ],
        "Thứ 6": [
            {
                "Môn học": "Toán",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "13:45 - 14:30"
            },
            {
                "Môn học": "Ngoại ngữ",
                "Thời gian": "14:45 - 15:30"
            },
            {
                "Môn học": "*HĐTNHN",
                "Thời gian": "15:30 - 16:15"
            }
        ],
        "Thứ 7": [
            {
                "Môn học": "Lịch sử và Địa lý",
                "Thời gian": "13:00 - 13:45"
            },
            {
                "Môn học": "Mỹ thuật",
                "Thời gian": "13:45 - 14:30"
            }
        ]
    },
    "lop91": {
        "Thứ 2": [
            {
                "Môn học": "Chào cờ",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Ngoại ngữ",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Sinh hoạt lớp",
                "Thời gian": "10:15 - 11:00"
            }
        ],
        "Thứ 3": [
            {
                "Môn học": "Hóa học",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "GDCD",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "9:30 - 10:15"
            },
            {
                "Môn học": "Sinh học",
                "Thời gian": "10:15 - 11:00"
            },
            {
                "Môn học": "GD Địa Phương",
                "Thời gian": "13:45 - 14:30"
            },
            {
                "Môn học": "Tin học",
                "Thời gian": "14:45 - 15:30"
            },
            {
                "Môn học": "Thể dục",
                "Thời gian": "15:30 - 16:15"
            },
            {
                "Môn học": "Thể dục",
                "Thời gian": "16:15 - 17:00"
            }
        ],
        "Thứ 4": [
            {
                "Môn học": "Toán",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Vật lí",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "*HĐTNHN",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Lịch sử và Địa lý",
                "Thời gian": "9:30 - 10:15"
            }
        ],
        "Thứ 5": [
            {
                "Môn học": "Ngoại ngữ",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Lịch sử và Địa lý",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Toán",
                "Thời gian": "9:30 - 10:15"
            }
        ],
        "Thứ 6": [
            {
                "Môn học": "Vật lí",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Âm nhạc",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Công nghệ",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Lịch sử và Địa lý",
                "Thời gian": "9:30 - 10:15"
            }
        ],
        "Thứ 7": [
            {
                "Môn học": "Ngữ văn",
                "Thời gian": "7:00 - 7:45"
            },
            {
                "Môn học": "Công nghệ",
                "Thời gian": "7:45 - 8:30"
            },
            {
                "Môn học": "Mỹ thuật",
                "Thời gian": "8:45 - 9:30"
            },
            {
                "Môn học": "Ngoại ngữ",
                "Thời gian": "9:30 - 10:15"
            }
        ]
    }
};

document.addEventListener('DOMContentLoaded', function () {
    const classSelect = document.getElementById('class-select');
    const TKBContainer = document.getElementById('TKB');
    const daysOfWeek = ['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7', 'Chủ nhật'];

    function renderTimetable(classKey) {
        TKBContainer.innerHTML = ''; // Xóa nội dung cũ

        const timetable = timetables[classKey];

        function updateTimetable() {
            const today = new Date();
            const todayDay = today.getDay(); // 0 (Sunday) to 6 (Saturday)
            const todayName = daysOfWeek[todayDay === 0 ? 6 : todayDay - 1]; // Convert 0-6 to "Thứ 2" - "Chủ nhật"
            console.log(`Today is: ${todayName}`);
            const sortedDays = sortDaysStartingFrom(todayName);

            sortedDays.forEach(day => {
                const subjects = timetable[day];
                if (!subjects) return;

                const dayDiv = document.createElement('div');
                dayDiv.className = 'Thu';

                const dayTitle = document.createElement('h1');
                dayTitle.textContent = day;

                if (day === todayName) {
                    const todaySpan = document.createElement('span');
                    todaySpan.textContent = ' (hôm nay)';
                    dayTitle.appendChild(todaySpan);
                }

                dayDiv.appendChild(dayTitle);

                const morningSubjects = subjects.filter(subject => {
                    const time = subject["Thời gian"].split(" - ")[0];
                    return isMorning(time);
                });

                const afternoonSubjects = subjects.filter(subject => {
                    const time = subject["Thời gian"].split(" - ")[0];
                    return !isMorning(time);
                });

                if (morningSubjects.length > 0) {
                    const morningDiv = document.createElement('div');
                    morningDiv.className = 'TietHoc';
                    const morningTitle = document.createElement('h2');
                    morningTitle.textContent = 'Sáng';
                    morningDiv.appendChild(morningTitle);

                    const ulMorning = document.createElement('ul');
                    morningSubjects.forEach(subject => {
                        const liElement = document.createElement('li');
                        liElement.textContent = subject["Môn học"];

                        const spanTime = document.createElement('span');
                        spanTime.className = 'time';
                        spanTime.textContent = subject["Thời gian"];

                        if (day === todayName && isSubjectActive(subject["Thời gian"], today)) {
                            liElement.classList.add('Active');
                        }

                        liElement.appendChild(spanTime);
                        ulMorning.appendChild(liElement);
                    });
                    morningDiv.appendChild(ulMorning);
                    dayDiv.appendChild(morningDiv);
                }

                if (afternoonSubjects.length > 0) {
                    const afternoonDiv = document.createElement('div');
                    afternoonDiv.className = 'TietHoc';
                    const afternoonTitle = document.createElement('h2');
                    afternoonTitle.textContent = 'Chiều';
                    afternoonDiv.appendChild(afternoonTitle);

                    const ulAfternoon = document.createElement('ul');
                    afternoonSubjects.forEach(subject => {
                        const liElement = document.createElement('li');
                        liElement.textContent = subject["Môn học"];

                        const spanTime = document.createElement('span');
                        spanTime.className = 'time';
                        spanTime.textContent = subject["Thời gian"];

                        if (day === todayName && isSubjectActive(subject["Thời gian"], today)) {
                            liElement.classList.add('Active');
                        }

                        liElement.appendChild(spanTime);
                        ulAfternoon.appendChild(liElement);
                    });
                    afternoonDiv.appendChild(ulAfternoon);
                    dayDiv.appendChild(afternoonDiv);
                }

                TKBContainer.appendChild(dayDiv);
            });
        }

        // Initial render
        updateTimetable();

        // Update every second
        setInterval(updateTimetable, 1000);
    }

    // Call renderTimetable with the selected class key, for example:
    renderTimetable('classKey'); // Replace 'classKey' with the actual key or logic to select the class
});


    function sortDaysStartingFrom(startDay) {
        const startIndex = daysOfWeek.indexOf(startDay);
        return [...daysOfWeek.slice(startIndex), ...daysOfWeek.slice(0, startIndex)];
    }

    function isMorning(time) {
        const [hour, minute] = time.split(":").map(Number);
        return (hour >= 7 && hour < 11);
    }

    function isSubjectActive(timeRange, currentDate) {
        const [startTime, endTime] = timeRange.split(" - ").map(parseTime);
        const currentTime = currentDate.getHours() * 60 + currentDate.getMinutes();

        return currentTime >= startTime && currentTime < endTime;
    }

    function parseTime(timeString) {
        const [hour, minute] = timeString.split(":").map(Number);
        return hour * 60 + minute;
    }

    // Render lần đầu khi trang tải
    renderTimetable(classSelect.value);

    // Lắng nghe sự thay đổi của dropdown
    classSelect.addEventListener('change', function () {
        renderTimetable(classSelect.value);
    });
});


// Update
// Hàm để thêm số 0 vào trước các số nhỏ hơn 10
function addZero(num) {
    return num < 10 ? '0' + num : num;
}

// Hàm để lấy và định dạng ngày giờ hiện tại
function getCurrentDateTime() {
    const today = new Date();
    const days = ['Chủ nhật', 'Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7'];
    const dayName = days[today.getDay()];
    const day = today.getDate();
    const month = today.getMonth() + 1; // Tháng trong JavaScript bắt đầu từ 0, nên cần cộng 1
    const year = today.getFullYear();
    const hours = addZero(today.getHours());
    const minutes = addZero(today.getMinutes());
    const seconds = addZero(today.getSeconds());

    return `${hours}:${minutes}:${seconds} \n ${dayName}, ${day} thg ${month}`;
}

// Hàm cập nhật thời gian mỗi giây
function updateTime() {
    document.getElementById('currentDate').innerText = getCurrentDateTime();
}

// Cập nhật thời gian ngay khi trang được tải
updateTime();

// Cập nhật thời gian mỗi giây
setInterval(updateTime, 1000);